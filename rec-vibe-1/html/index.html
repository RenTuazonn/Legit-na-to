<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PUP Login System</title>
  <link rel="stylesheet" href="login.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="icon" href="rec3.png" type="image/png" />
</head>
<body>

  <!-- Main Wrapper -->
  <div class="main-container">
    
    <!-- Left Side: Welcome Text -->
    <div class="welcome-text">
      <h1>Welcome to Recovibe</h1>
      <p>Welcome to Recovibe, your personalized event companion at PUP Bi√±an! This platform is designed to help you discover and engage with campus events that truly match your interests, goals, and schedule. Whether you're a student exploring new opportunities, a faculty member staying connected, or simply looking to get more involved, Recovibe uses smart recommendations to bring the right events to you. With features like personalized suggestions, easy event registration, and feedback tracking, your campus experience becomes more connected, meaningful, and enjoyable, all in one place.</p>
    </div>

    <!-- Right Side: Login Form -->
    <div class="login-box">
      <h2>WELCOME PUP-IANS!</h2>
      <form id="login-form">
        <div class="form-group">
          <label for="username">Email:</label>
          <input type="email" id="username" name="username" required />
        </div>
        <div class="form-group">
          <label for="password">Password:</label>
          <div class="password-wrapper">
            <input type="password" id="password" name="password" required />
            <i id="togglePassword" class="fas fa-eye toggle-password"></i>
          </div>
        </div>
        <button type="submit" id="loginBtn" class="login-button">Log In</button>
      </form>
      <div class="forgot">
        <a href="#">Forgot Password?</a>
      </div>
      <form action="createacc.html" method="get">
        <button type="submit" class="create-button">Create an Account</button>
      </form>
    </div>

  </div>

  <!-- Firebase Login Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-auth.js";
    import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAvJKueNtBRrGFxXby-VRkOewdGEkiuGnQ",
      authDomain: "first-proj-a5fff.firebaseapp.com",
      projectId: "first-proj-a5fff",
      storageBucket: "first-proj-a5fff.appspot.com",
      messagingSenderId: "902560724938",
      appId: "1:902560724938:web:2956090fc8afb5ce888133",
      measurementId: "G-0VNSBVGRK7",
      databaseURL: "https://first-proj-a5fff-default-rtdb.firebaseio.com"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const database = getDatabase(app);

    document.getElementById("login-form").addEventListener("submit", async (event) => {
      event.preventDefault();

      const email = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        let userExists = false;

        // Check Realtime Database
        const dbRef = ref(database);
        const dbSnapshot = await get(child(dbRef, `users/${user.uid}`));
        if (dbSnapshot.exists()) {
          userExists = true;
        }

        if (userExists) {
          window.location.href = "ai.html"; // Existing user
        } else {
          window.location.href = "1st.html"; // New user onboarding
        }
      } catch (error) {
        alert("Login Failed: " + error.message);
      }
    });
  </script>

  <!-- Password Show/Hide -->
  <script>
    const togglePassword = document.getElementById("togglePassword");
    const passwordField = document.getElementById("password");

    togglePassword.addEventListener("click", function () {
      const type = passwordField.getAttribute("type") === "password" ? "text" : "password";
      passwordField.setAttribute("type", type);
      this.classList.toggle("fa-eye");
      this.classList.toggle("fa-eye-slash");
    });
  </script>

</body>
</html>
