<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RecoVibe Login</title>
  <link rel="stylesheet" href="login.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="icon" href="rec3.png" type="image/png" />
</head>
<body>

  <!-- Main Wrapper -->
  <div class="main-container">
    <!-- Profile Icon -->
<div class="profile-icon" id="profileIcon">
  <i class="fas fa-user-circle"></i>
</div>
<!-- Profile Frame -->
<div id="profile-frame" style="display: none;">
  <h2>Your Profile</h2>
  <p>Welcome! This is your profile screen.</p>
  <button id="backBtn">Back to Login</button>
</div>



    
    <!-- Left Side: Welcome Text -->
    <div class="welcome-text">
      <h1>Welcome to Recovibe</h1>
      <p>Welcome to Recovibe, your personalized event companion at PUP Bi√±an! This platform is designed to help you discover and engage with campus events that truly match your interests, goals, and schedule. Whether you're a student exploring new opportunities, a faculty member staying connected, or simply looking to get more involved, Recovibe uses smart recommendations to bring the right events to you. With features like personalized suggestions, easy event registration, and feedback tracking, your campus experience becomes more connected, meaningful, and enjoyable, all in one place.</p>
    </div>

    <!-- Right Side: Login Form -->
    <div class="login-box">
      <h2>WELCOME PUP-IANS!</h2>
      <form id="login-form">
        <div class="form-group">
          <label for="username">Email:</label>
          <input type="email" id="username" name="username" required />
        </div>
        <div class="form-group">
          <label for="password">Password:</label>
          <div class="password-wrapper">
            <input type="password" id="password" name="password" required />
            <i id="togglePassword" class="fas fa-eye toggle-password"></i>
          </div>
        </div>
        <button type="submit" id="loginBtn" class="login-button">Log In</button>
      </form>
      <div class="forgot">
        <a href="#">Forgot Password?</a>
      </div>
      <form action="createacc.html" method="get">
        <button type="submit" class="create-button">Create an Account</button>
      </form>
    </div>

  </div>

  <!-- Firebase Login Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
    import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";
    

    const firebaseConfig = {
      apiKey: "AIzaSyAvJKueNtBRrGFxXby-VRkOewdGEkiuGnQ",
      authDomain: "first-proj-a5fff.firebaseapp.com",
      projectId: "first-proj-a5fff",
      storageBucket: "first-proj-a5fff.appspot.com",
      messagingSenderId: "902560724938",
      appId: "1:902560724938:web:2956090fc8afb5ce888133",
      measurementId: "G-0VNSBVGRK7",
      databaseURL: "https://first-proj-a5fff-default-rtdb.firebaseio.com"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const database = getDatabase(app);

    document.getElementById("login-form").addEventListener("submit", async (event) => {
  event.preventDefault();

  const email = document.getElementById("username").value;
  const password = document.getElementById("password").value;

  try {
    const userCredential = await signInWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;

    // Check Realtime Database for user profile data
    const dbRef = ref(database);
    const dbSnapshot = await get(child(dbRef, `users/${user.uid}`));
    let hasProfile = false;

    if (dbSnapshot.exists()) {
      const userData = dbSnapshot.val();
      // If userData is an object and has at least one property, consider as registered
      if (userData && typeof userData === "object" && Object.keys(userData).length > 0) {
        hasProfile = true;
      }
      // If you want to check for specific fields, you can keep the old logic as fallback:
      
      for (const key in userData) {
        const entry = userData[key];
        if (
          entry &&
           entry.email &&
          entry.birthday &&
          entry.course &&
          entry.year &&
          entry.section &&
          entry.organization
        ) {
          hasProfile = true;
          break;
        }
      }
      
    }

    // Show success message before redirecting
    alert("Login successful! Redirecting...");

    // Redirect after short delay (optional, adds polish)
    setTimeout(() => {
      if (hasProfile) {
        window.location.href = "1st.html";
      } else {
        window.location.href = "ai.html";
      }
    }, 1000); // 1 second delay

  } catch (error) {
    // Improved error handling for wrong password and user not found
    let message = "Login Failed: ";
    if (error.code === "auth/wrong-password") {
      message += "Incorrect password. Please try again.";
    } else if (error.code === "auth/user-not-found") {
      message += "No user found with this email.";
    } else if (error.code === "auth/invalid-email") {
      message += "Invalid email address.";
    } else {
      message += error.message;
    }
    alert(message);
  }
});

  const profileIcon = document.getElementById("profileIcon");

  profileIcon.addEventListener("click", () => {
    alert("Will redirect you to the Admin Login...");
    window.location.href = "admin123.html";
  });


  </script>

</body>
</html>
