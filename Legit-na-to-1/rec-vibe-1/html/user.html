<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>User Dashboard - CampusConnect</title>
  <link rel="stylesheet" href="dash.css" />
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <div class="main-container">
    <div class="welcome-text">
      <h1>👋 Welcome, Student!</h1>
      <p>Browse and join campus events that interest you.</p>
    </div>
    <div class="right-content">
      <button class="back-button" onclick="window.location.href='ai.html'">🔙 Back</button>
      <div class="card">
        <h2>📅 All Campus Events</h2>
        <input class="filter-input" type="text" id="eventSearch" placeholder="🔍 Search events..." />
        <div id="eventsList"></div>
      </div>
    </div>
  </div>
  <script>
    // Use the same Firebase config as your other pages
    const firebaseConfig = {
      apiKey: "AIzaSyAvJKueNtBRrGFxXby-VRkOewdGEkiuGnQ",
      authDomain: "first-proj-a5fff.firebaseapp.com",
      projectId: "first-proj-a5fff",
      storageBucket: "first-proj-a5fff.appspot.com",
      messagingSenderId: "902560724938",
      appId: "1:902560724938:web:2956090fc8afb5ce888133",
      measurementId: "G-0VNSBVGRK7"
    };
    // Prevent double initialization
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const firestore = firebase.firestore();

    async function fetchEvents() {
      const eventsList = document.getElementById('eventsList');
      eventsList.innerHTML = '';
      try {
        const snapshot = await firestore.collection('events').get();
        if (snapshot.empty) {
          eventsList.innerHTML = '<p>No events found.</p>';
          return;
        }
        snapshot.forEach(doc => {
          const event = doc.data();
          const eventElement = document.createElement('div');
          eventElement.classList.add('event');
          eventElement.innerHTML = `
            <h3>${event.name || ''}</h3>
            <p>${event.description || ''}</p>
            <p><strong>Category:</strong> ${event.category || ''}</p>
            <p><strong>Date:</strong> ${event.date || ''}</p>
            <p><strong>Time:</strong> ${event.time || ''}</p>
            <p><strong>Location:</strong> ${event.location || ''}</p>
            <button style="margin-top:10px;background:#039be5;color:#fff;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;">View Details</button>
          `;
          eventsList.appendChild(eventElement);
        });
      } catch (error) {
        eventsList.innerHTML = `<p>Error loading events: ${error.message}</p>`;
      }
    }

    document.getElementById('eventSearch').addEventListener('input', async function() {
      const search = this.value.toLowerCase();
      const eventsList = document.getElementById('eventsList');
      try {
        const snapshot = await firestore.collection('events').get();
        eventsList.innerHTML = '';
        let found = false;
        snapshot.forEach(doc => {
          const event = doc.data();
          if (
            (event.name && event.name.toLowerCase().includes(search)) ||
            (event.description && event.description.toLowerCase().includes(search))
          ) {
            found = true;
            const eventElement = document.createElement('div');
            eventElement.classList.add('event');
            eventElement.innerHTML = `
              <h3>${event.name || ''}</h3>
              <p>${event.description || ''}</p>
              <p><strong>Category:</strong> ${event.category || ''}</p>
              <p><strong>Date:</strong> ${event.date || ''}</p>
              <p><strong>Time:</strong> ${event.time || ''}</p>
              <p><strong>Location:</strong> ${event.location || ''}</p>
              <button style="margin-top:10px;background:#039be5;color:#fff;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;">View Details</button>
            `;
            eventsList.appendChild(eventElement);
          }
        });
        if (!found) {
          eventsList.innerHTML = '<p>No events found.</p>';
        }
      } catch (error) {
        eventsList.innerHTML = `<p>Error loading events: ${error.message}</p>`;
      }
    });

    document.addEventListener('DOMContentLoaded', fetchEvents);
  </script>
</body>
</html>
